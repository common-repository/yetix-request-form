!function(e){const{__:t,_x:n,_n:r,_nx:o,sprintf:i}=wp.i18n;var s={};function a(n){var o=e(n).parent().attr("id"),s=function(t){var n={};return e(t).find(".field-wrapper").each(function(){var t=e(this).data("name");e(this).find("#requestform_"+t).each(function(){var r=function(t){if(console.log(this),["select-one","select-multiple","hidden"].includes(t.type))return e(t).val();if(!["checkbox","radio"].includes(t.type)){if(0<e(t).parent(".yetix-calendar").length){var n=function(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n},r=e(t).parent(".yetix-calendar").calendar("get date");if(r)var o=r.getFullYear()+"-"+n(r.getMonth()+1,2)+"-"+n(r.getDate(),2);else var o=null;return o}return e(t).hasClass("mce-content-body")?tinyMCE.get(e(t).attr("id")).getContent():e.trim(t.value)}return t.checked?t.value:null}(this);r&&0<r.length&&(void 0===n[t]?n[t]=r:Array.isArray(n[t])?n[t].push(r):(n[t]=[n[t]],n[t].push(r)))})}),n}(n);!function(t){var n=e("#"+t).find(".message");n.empty(),n.removeClass("error success"),n.hide(),f(t)}(o),e.ajax({url:requestform.ticket_api_url,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",requestform[o].nonce)},method:"POST",data:s,success:function(t){!function(t,n,r){var o=e("#"+t).find(".form-message"),i=e("#"+t).find(".form");h(i),o.append('<span class="content">'+r+"</span>"),o.addClass("message success center aligned"),o.show(),requestform[t].hide_form_after_send&&i.hide();if("redirect"===requestform[t].return.type)return void setTimeout(function(){var e=new URL(requestform[t].return.url);e.searchParams.set("code",n),e.searchParams.set("msg",r),window.location.href=e},requestform[t].return.timeout);(!requestform[t].hide_form_after_send||0<requestform[t].return.timeout)&&setTimeout(function(){o.hide(),i.show(),m(i)},requestform[t].return.timeout)}(o,t.code,t.message)},error:function(n){!function(n,o,s,a){var d=e("#"+n).find(".form-message"),l=e("#"+n).find(".form");if(h(l),"rest_invalid_param"===o){var f=[];for(const[e,r]of Object.entries(a.data.params))c(n,e,o,i(t("%s field is invalid.","yetix-request-form"),requestform.localize.field_labels[e])),f.push(requestform.localize.field_labels[e]);s=i(r("%1$s field is invalid.%2$s %3$s.","%1$s fields are invalid.%2$s %3$s.",f.length,"yetix-request-form"),f.length,"<br>",f.join(", "))}else if("rest_missing_callback_param"===o){var f=[];for(const[e,r]of Object.entries(a.data.params))c(n,r,o,i(t("%s field is missing.","yetix-request-form"),requestform.localize.field_labels[r])),f.push(requestform.localize.field_labels[r]);s=i(r("%1$s field is missing.%2$s %3$s.","%1$s fields are missing.%2$s %3$s.",f.length,"yetix-request-form"),f.length,"<br>",f.join(", "))}d.append('<span class="content">'+s+"</span>"),d.addClass("message error center aligned"),d.show(),m(l)}(o,n.responseJSON.code,n.responseJSON.message,n.responseJSON)}})}function d(n){var r=e(n).parent().attr("id"),o=function(t){var n=new FormData,r=e(t).find("#requestform_attachment_file").prop("files");for(const[e,t]of Object.entries(r))n.append("file[]",t);return n.append("fail","safe"),n}(n),i=e("#"+r).find(".yetix-progress");void 0===s[r]&&(s[r]={}),void 0!==s[r].progress_bar&&window.clearTimeout(s[r].progress_bar),i.progress("reset"),i.removeClass("indeterminate indicating success error"),i.show(),u(n),e.ajax({url:requestform.attachment_api_url,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",requestform[r].nonce)},xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",n=>(function(n,r){if(r.lengthComputable){var o=r.loaded/r.total*100,i=e("#"+n).find(".yetix-progress");0<i.length&&(i.progress("set percent",o),100>o?i.addClass("indicating"):(i.removeClass("indicating"),i.addClass("indeterminate"),setTimeout(()=>i.progress("set bar label",t("Processing","yetix-request-form")),500)))}})(r,n),!1),n},method:"POST",data:o,processData:!1,contentType:!1,cache:!1,success:function(o){!function(t,n){var r=e("#"+t).find("#requestform_attachment_token").val();r=0===r.length?[]:r.split(","),n.forEach(function(e){"success"===e.code&&r.push(e.token)}),e("#"+t).find("#requestform_attachment_token").val(r)}(r,o.attachments),function(t,n,r,o,i){var s=e("#"+t).find('.field-wrapper[data-name="'+n+'"] > .field-message'),a=e("#"+t).find('.field-wrapper[data-name="'+n+'"] > .file-list');s.removeClass("error success"),s.empty(),i.forEach(function(n){var r=e('<button class="ui icon button"><i class="times icon"></i></button>'),o=e('<div class="item '+n.code+'" ><div class="inner"><span class="content">'+n.file_name+'</span></div><div class="message">'+n.message+"</div></div>");"success"===n.code?(o.attr("data-token",n.token),o.find(".inner").append(r),r.on("click",function(){!function(t,n){var r=e("#"+t).find("#requestform_attachment_token").val();r=(r=0===r.length?[]:r.split(",")).filter(function(e){return e!==n}),e("#"+t).find("#requestform_attachment_token").val(r),e("#"+t).find('[data-token="'+n+'"]').remove(),f(t,"attachment_token")}(t,n.token)}),setTimeout(function(){o.find(".message").remove()},1e4)):setTimeout(function(){o.remove()},1e4),a.append([o])}),s.append('<span class="message">'+o+"</span>"),"zendesk_attachment_send"===r&&s.addClass("success");s.show()}(r,"attachment_token",o.code,o.message,o.attachments),e("#"+r).find("#requestform_attachment_file").val(""),e("#"+r).find("#requestform_attachment_file").trigger("change"),l(r,"success",t("Upload complete","yetix-request-form")),p(n)},error:function(o){c(r,"attachment_token",o.responseJSON.code,o.responseJSON.message),e("#"+r).find("#requestform_attachment_file").val(""),e("#"+r).find("#requestform_attachment_file").trigger("change"),l(r,"error",t("Upload error","yetix-request-form")),p(n)}})}function l(t,n,r){var o=e("#"+t).find(".yetix-progress");0<o.length&&(o.removeClass("indeterminate indicating"),o.addClass(n),o.progress("set bar label",r),s[t].progress_bar=setTimeout(function(){o.progress("reset"),o.hide()},5e3))}function c(t,n,r,o){var i=e("#"+t).find('.field-wrapper[data-name="'+n+'"] > .field-message');i.removeClass("error success"),i.empty(),i.append('<span class="error">'+o+"</span>"),i.addClass("message error"),i.show()}function f(t,n=null){var r=n?e("#"+t).find('.field-wrapper[data-name="'+n+'"] > .field-message'):e("#"+t).find(".field-wrapper > .field-message");r.empty(),r.removeClass("error success"),r.hide()}function m(e){e.find("button,input,textarea,select").prop("disabled",!1),e.find(".yetix-dropdown").removeClass("disabled"),p(e)}function u(e){e.find("#requestform_attachment_file").prop("disabled",!0),e.find("#requestform_attachment_upload").prop("disabled",!1),e.find("#requestform_attachment_upload").addClass("disabled")}function p(e){e.find("#requestform_attachment_file").prop("disabled",!1),e.find("#requestform_attachment_upload").prop("disabled",!1),e.find("#requestform_attachment_upload").removeClass("disabled")}function h(e){e.siblings(".loading").hide()}e(".yetix-progress").progress(),e(".yetix-progress").hide(),e(".yetix-checkbox").checkbox(),e(".yetix-dropdown").dropdown(),e(".yetix-calendar").calendar({type:"date",text:{days:[n("S","first letter of Sunday","yetix-request-form"),n("M","first letter of Monday","yetix-request-form"),n("T","first letter of Tuesday","yetix-request-form"),n("W","first letter of Wednesday","yetix-request-form"),n("T","first letter of Thursday","yetix-request-form"),n("F","first letter of Friday","yetix-request-form"),n("S","first letter of Saturday","yetix-request-form")],months:[t("January","yetix-request-form"),t("February","yetix-request-form"),t("March","yetix-request-form"),t("April","yetix-request-form"),t("May","yetix-request-form"),t("June","yetix-request-form"),t("July","yetix-request-form"),t("August","yetix-request-form"),t("September","yetix-request-form"),t("October","yetix-request-form"),t("November","yetix-request-form"),t("December","yetix-request-form")],monthsShort:[n("Jan","short for January","yetix-request-form"),n("Feb","short for February","yetix-request-form"),n("Mar","short for March","yetix-request-form"),n("Apr","short for April","yetix-request-form"),n("May","short for May","yetix-request-form"),n("Jun","short for June","yetix-request-form"),n("Jul","short for July","yetix-request-form"),n("Aug","short for August","yetix-request-form"),n("Sep","short for September","yetix-request-form"),n("Oct","short for October","yetix-request-form"),n("Nov","short for November","yetix-request-form"),n("Dec","short for December","yetix-request-form")],today:t("Today","yetix-request-form"),now:t("Now","yetix-request-form"),am:n("AM","short for ante meridiem","yetix-request-form"),pm:n("PM","short for post meridiem","yetix-request-form")}}),e("button.yetix-requestform-attachment-upload").on("click",function(t){t.preventDefault(),d(e(this).parents("form"))}),e("form.yetix-requestform").on("submit",function(t){t.preventDefault(),e(this).siblings(".loading").show(),function(e){e.find("button,input,textarea,select").prop("disabled",!0),e.find(".yetix-dropdown").addClass("disabled"),u(e)}(e(this)),a(e(this))}),e(".yetix-requestform-readonly").on("keypress",function(t){t.preventDefault(),13===t.which&&e(this).siblings("#requestform_attachment_file").trigger("click")}),e("input, textarea, select").on("click",function(){var t=e(this).parents(".wp-block-yetix-requestform");t.length&&f(t.attr("id"),e(this).parents(".field-wrapper").data("name"))}),e("input:text").click(function(){e(this).siblings("input:file").click()}),e("input:file",".ui.action.input").on("change",function(n){var o=t("No files selected.","yetix-request-form");0<this.files.length&&(o=i(r("%s file selected.","%s files selected.",this.files.length,"yetix-request-form"),this.files.length)),e(this).siblings("input:text").val(o)}),tinymce.init({selector:"#requestform_description",plugins:"hr lists",inline:!0,toolbar:"bold italic underline | bullist numlist | blockquote code pre hr | undo redo ",menubar:!1,statusbar:!0,setup:function(e){e.addButton("code",{icon:"code",onclick:function(){e.execCommand("mceToggleFormat",!1,"code")},onpostrender:function(){var t=this;e.on("init",function(){e.formatter.formatChanged("code",function(e){t.active(e)})})}}),e.addButton("pre",{icon:"codesample",onclick:function(){e.execCommand("mceToggleFormat",!1,"pre")},onpostrender:function(){var t=this;e.on("init",function(){e.formatter.formatChanged("pre",function(e){t.active(e)})})}}),e.addButton("blockquote",{icon:"blockquote",onclick:function(){e.execCommand("mceToggleFormat",!1,"blockquote")},onpostrender:function(){var t=this;e.on("init",function(){e.formatter.formatChanged("blockquote",function(e){t.active(e)})})}})}})}(jQuery);